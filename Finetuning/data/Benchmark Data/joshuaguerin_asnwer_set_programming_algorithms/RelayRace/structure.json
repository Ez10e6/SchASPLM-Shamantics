{
  "instance_template": "participant(\"Alice\"). leg(1, \"Start\", \"Point A\"). legTime(1). legDist(1, 5). legAscent(1, 100). preferredDistance(\"Alice\", 10). preferredPace(\"Alice\", 6). objective(1, \"dist-pref\"). objective(2, \"duration\"). objective(3, \"pace-pref\"). objective(4, \"exchange-count\").",
  "generator": "{ run(P, T) : participant(P) } = 1 :- legTime(T).",
  "hard_constraints": [
    {
      "description": "Sanity check: every leg must be assigned to a runner.",
      "asp_rule": ":- legTime(T), #count { P : run(P, T) } != 1."
    }
  ],
  "soft_constraints": [
    {
      "description": "Let's calculate the total distance each runner covers.",
      "asp_rule": "participantDist(P, Total) :- participant(P), Total = #sum { D, T : run(P, T), legDist(T, D) }."
    },
    {
      "description": "Keep runners happy by minimizing the gap between their preferred distance and what they actually ran.",
      "asp_rule": "penalty(\"dist_pref\", P, Diff, Priority) :- participantDist(P, Act), preferredDistance(P, Pref), Diff = Act - Pref, Act >= Pref, objective(Priority, \"dist-pref\"). penalty(\"dist_pref\", P, Diff, Priority) :- participantDist(P, Act), preferredDistance(P, Pref), Diff = Pref - Act, Pref > Act, objective(Priority, \"dist-pref\")."
    },
    {
      "description": "Calculate how long a leg takes based on the runner's pace.",
      "asp_rule": "legDuration(T, D * P) :- legDist(T, D), run(P, T), preferredPace(P, P), legTime(T)."
    },
    {
      "description": "Try to keep the total race time as low as possible.",
      "asp_rule": "penalty(\"duration\", T, Dur, Priority) :- legDuration(T, Dur), objective(Priority, \"duration\")."
    },
    {
      "description": "Minimize the difference between the runner's preferred pace and the actual leg pace.",
      "asp_rule": "penalty(\"pace_pref\", (P, T), Diff, Priority) :- run(P, T), preferredPace(P, Pref), legDuration(T, Dur), legDist(T, Dist), Dist > 0, ActPace = Dur / Dist, Diff = ActPace - Pref, ActPace >= Pref, objective(Priority, \"pace-pref\"). penalty(\"pace_pref\", (P, T), Diff, Priority) :- run(P, T), preferredPace(P, Pref), legDuration(T, Dur), legDist(T, Dist), Dist > 0, ActPace = Dur / Dist, Diff = Pref - ActPace, Pref > ActPace, objective(Priority, \"pace-pref\")."
    },
    {
      "description": "Gotta minimize handoffs so the baton doesn't hit the dirt.",
      "asp_rule": "handoff(T) :- run(P1, T), run(P2, T+1), P1 != P2, legTime(T), legTime(T+1). penalty(\"exchange_count\", T, 1, Priority) :- handoff(T), objective(Priority, \"exchange-count\")."
    }
  ],
  "global_objective": "#minimize { Cost @ Priority, Type, Id : penalty(Type, Id, Cost, Priority) }."
}