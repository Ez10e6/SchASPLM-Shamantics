% There are 10 presentations.
presentation(1..10).

% Presentations are in AI, Cloud, IoT, or VR.
topic("AI"; "Cloud"; "IoT"; "VR").
1 { topicOf(P, T) : topic(T) } 1 :- presentation(P).

% The schedule spans 4 days, with 4 time slots per day.
day(1..4).
slot(1..4).

% There are 5 rooms.
room(1..5).

% Each presentation must be scheduled.
1 { scheduled(P, R, Sl, D) : room(R), slot(Sl), day(D) } :- presentation(P).

% Only one presentation per roomâ€‘time.
:- scheduled(P1, R, Sl, D), scheduled(P2, R, Sl, D), P1 != P2.

% Each room can be used at most three times per day.
{ scheduled(P, R, Sl, D) : presentation(P), slot(Sl) } 3 :- room(R), day(D).

% Rooms cannot be booked in consecutive slots.
:- scheduled(_, R, Sl1, D), scheduled(_, R, Sl2, D), Sl1 = Sl2 - 1.

% Room 2 has no projector; AI and Cloud require a projector.
-projector(2).
:- scheduled(P, R, _, _), topicOf(P, T), T = "AI", -projector(R).
:- scheduled(P, R, _, _), topicOf(P, T), T = "Cloud", -projector(R).

% VR cannot be in room 1.
:- scheduled(P, 1, _, _), topicOf(P, "VR").

% IoT presentations must be spread across at least three days.
hasIoT(D) :- scheduled(P, _, _, D), topicOf(P, "IoT").
:- #count { D : hasIoT(D) } < 3.

% VR and AI cannot be on the same day in the same room.
:- scheduled(P1, R, _, D), scheduled(P2, R, _, D),
   topicOf(P1, "VR"), topicOf(P2, "AI").

% At most two Cloud and IoT presentations may overlap in any slot.
cloudOrIoT(P, Sl, D) :- scheduled(P, _, Sl, D), topicOf(P, "Cloud").
cloudOrIoT(P, Sl, D) :- scheduled(P, _, Sl, D), topicOf(P, "IoT").
:- day(D), slot(S), #count { P : cloudOrIoT(P, Sl, D) } > 2.

% Only AI can be in slot 1 of day 1.
:- scheduled(P, _, 1, 1), not topicOf(P, "AI").

% Only VR can be in slot 3 of day 4.
:- scheduled(P, _, 3, 4), not topicOf(P, "VR").

% Each day must have at least one presentation.
:- day(D), not scheduled(_, _, _, D).

% At least two different topics must occur in every time slot across all rooms.
hasTopic(T, Sl, D) :- scheduled(P, _, Sl, D), topicOf(P, T).
:- slot(Sl), day(D), #count { T : hasTopic(T, Sl, D) } < 2.

% Maximize the number of rooms used per slot, then minimize idle slots.
used(R, Sl, D) :- scheduled(_, R, Sl, D).
roomsUsed(N, Sl, D) :- N = #count { R : used(R, Sl, D) }, slot(Sl), day(D).
#maximize { N@2 : roomsUsed(N, Sl, D) }.

idle(R, Sl, D) :- room(R), slot(Sl), day(D), not used(R, Sl, D).
num_idle(N) :- N = #count{R, Sl, D: idle(R, Sl, D) }.
#minimize { N@1: num_idle(N) }.